<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Versus Revise - Absolute Auditor (Shin-Hanabi Initial Position)</title>
    <style>
        /* index.html のUI/CSSを完全継承 */
        :root { --c-bg: #000; --c-text: #eee; --c-accent: #ffd700; --c-border: #333; }
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; min-height: 100dvh; margin: 0; padding: 0; background: var(--c-bg); color: var(--c-text); font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif; overflow: hidden; display: flex; flex-direction: column; touch-action: manipulation; overscroll-behavior: none; -webkit-text-size-adjust: 100%; }
        .controls { padding: 4px; flex-shrink: 0; background: #111; border-bottom: 1px solid var(--c-border); z-index: 20; }
        .tab-group { display: flex; gap: 4px; margin-bottom: 4px; overflow-x: auto; }
        .tab { flex: 1; padding: 10px 0; text-align: center; font-size: 11px; font-weight: bold; cursor: pointer; border-radius: 4px; border: 1px solid #333; background: #1a1a1a; color: #888; white-space: nowrap; transition: all 0.1s; }
        .tab.active { opacity: 1; color: #fff; border-color: #777; box-shadow: 0 0 8px rgba(255,255,255,0.1); }
        .stop-tab.active#t-left { background: #600010; color: #ffb7ce; border-color: #ff80ab; }
        .stop-tab.active#t-middle { background: #001040; color: #b3e5fc; border-color: #80d8ff; }
        .stop-tab.active#t-right { background: #002005; color: #c8e6c9; border-color: #69f0ae; }
        .state-tab#s-bonus_unestablished.active { background: #ddd; color: #000; }
        .state-tab#s-x_big_established.active { background: #304ffe; color: #fff; }
        .state-tab#s-seven_big_established.active { background: #d50000; color: #fff; }
        .state-tab#s-reg_bonus_established.active { background: #333; color: #fff; border: 1px solid #fff; }
        .workspace { display: flex; flex-direction: row-reverse; flex: 1; overflow: hidden; padding: 8px; gap: 8px; background: #000; align-items: flex-start; justify-content: center; }
        .reel-container { width: 90px; height: 540px; position: relative; background: #000; border: 2px solid #444; border-radius: 4px; flex-shrink: 0; overflow: hidden; touch-action: none; }
        .reel-strip { position: absolute; width: 100%; top: 0; left: 0; will-change: transform; }
        .symbol { height: 60px; display: flex; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }
        .sym-idx { width: 24px; text-align: center; color: var(--c-accent); font-weight: bold; font-size: 11px; height: 100%; display: flex; align-items: center; justify-content: center; background: #111; border-right: 1px solid #333; }
        .sym-bg { flex: 1; height: 100%; background-color: #000; background-repeat: no-repeat; background-position: center; background-size: 85%; }
        .target-box { position: absolute; top: 180px; left: 0; width: 100%; height: 180px; border: 4px solid #f00; pointer-events: none; z-index: 10; box-shadow: inset 0 0 10px rgba(255,0,0,0.3); }
        .results { flex: 1; height: 540px; background: #111; border: 1px solid #333; overflow-y: auto; border-radius: 4px; display: flex; flex-direction: column; }
        .res-row { display: flex; align-items: center; border-bottom: 1px solid #222; height: 34px; padding: 0 6px; font-family: monospace; }
        .res-row:nth-child(odd) { background: rgba(255,255,255,0.03); }
        .res-name { width: 110px; font-size: 12px; font-weight: bold; flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1; }
        .res-data { flex: 1; display: flex; justify-content: flex-end; align-items: center; flex-wrap: nowrap; overflow: hidden; }
        .res-slip { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; margin-left: 1px; background: #222; border: 1px solid #444; border-radius: 2px; font-size: 13px; font-weight: bold; color: #eee; flex-shrink: 0; }
        .f-bell { border-left: 4px solid #ffeb3b; } .f-bell .res-name { color: #ffeb3b; }
        .f-suika { border-left: 4px solid #00e676; } .f-suika .res-name { color: #00e676; }
        .f-cher { border-left: 4px solid #ff4081; } .f-cher .res-name { color: #ff4081; }
        .f-rep { border-left: 4px solid #80d8ff; } .f-rep .res-name { color: #80d8ff; }
        .f-hazure { border-left: 4px solid #888; } .f-hazure .res-name { color: #aaa; }
        .f-tok { border-left: 4px solid #e040fb; } .f-tok .res-name { color: #e040fb; }
    </style>
</head>
<body>
    <div id="error-log"></div>
    <div class="controls">
        <div class="tab-group">
            <div id="t-left" class="stop-tab tab active" onclick="app.setStop('left')">左リール</div>
            <div id="t-middle" class="stop-tab tab" onclick="app.setStop('middle')">中リール</div>
            <div id="t-right" class="stop-tab tab" onclick="app.setStop('right')">右リール</div>
        </div>
        <div class="tab-group">
            <div id="s-bonus_unestablished" class="state-tab tab active" onclick="app.setState('bonus_unestablished')">ボーナス未成立</div>
            <div id="s-x_big_established" class="state-tab tab" onclick="app.setState('x_big_established')">ドンビッグ成立</div>
            <div id="s-seven_big_established" class="state-tab tab" onclick="app.setState('seven_big_established')">七ビッグ成立</div>
            <div id="s-reg_bonus_established" class="state-tab tab" onclick="app.setState('reg_bonus_established')">Regボーナス成立</div>
        </div>
    </div>
    <div class="workspace">
        <div id="touch-area" class="reel-container"><div class="target-box"></div><div id="reel-strip" class="reel-strip"></div></div>
        <div class="results" id="result-list"></div>
    </div>
<script>
const n = null;
const MASTER_RAW = {
    left: {
        bonus_unestablished: `21 1 2 1 1 2 3 2 2 4 4 4 null null null null null\n20 0 0 2 0 3 4 0 0 1 1 1 null null null null null\n19 0 1 3 1 4 4 0 0 2 2 2 null null null null null\n18 1 1 0 1 0 0 2 2 3 3 3 null null null null null\n17 0 0 1 0 0 1 1 1 4 4 4 null null null null null\n16 2 1 2 1 1 2 3 3 0 0 0 null null null null null\n15 3 2 3 2 2 3 3 3 1 1 1 null null null null null\n14 3 3 1 3 3 4 4 4 0 0 2 null null null null null\n13 0 4 2 4 4 4 0 0 1 1 1 null null null null null\n12 1 0 3 0 0 1 1 1 2 2 4 null null null null null\n11 0 1 0 0 1 2 1 1 3 3 3 null null null null null\n10 1 0 1 1 2 3 2 2 4 4 4 null null null null null\n9 2 1 2 1 3 4 2 2 1 1 1 null null null null null\n8 0 2 0 2 4 0 3 3 2 2 2 null null null null null\n7 1 0 1 0 0 0 4 4 3 3 3 null null null null null\n6 2 1 2 1 2 1 1 1 0 0 0 null null null null null\n5 3 2 3 2 2 3 3 3 1 1 1 null null null null null\n4 4 3 1 3 3 4 3 3 0 0 2 null null null null null\n3 0 4 2 4 4 4 0 0 1 1 1 null null null null null\n2 1 0 3 0 0 0 0 0 2 2 4 null null null null null\n1 1 1 0 0 1 2 1 1 3 3 3 null null null null null`,
        x_big_established: `21 3 2 1 2 2 2 3 3 4 4 4 3 1 1 3 3\n20 4 0 2 0 3 4 4 4 1 1 1 4 0 2 4 4\n19 0 1 0 1 4 4 0 0 2 2 2 4 0 0 2 0\n18 1 1 1 1 0 0 2 2 3 3 3 1 1 1 2 1\n17 0 0 1 0 0 1 1 1 4 4 4 1 2 2 4 0\n16 2 1 3 1 1 1 3 3 0 0 0 1 3 2 3 2\n15 2 2 3 2 2 3 3 3 1 1 1 4 3 4 3 2\n14 3 3 4 3 3 4 4 4 0 0 2 4 4 4 3 3\n13 0 4 0 4 0 4 0 0 1 1 1 0 0 0 0 0\n12 1 0 0 0 0 1 1 1 2 2 4 1 1 1 1 1\n11 0 1 1 1 1 1 0 0 3 3 3 0 0 0 0 0\n10 1 0 2 0 3 2 1 1 4 4 4 1 1 1 0 1\n9 1 1 4 1 4 4 2 2 1 1 1 2 2 1 2 1\n8 1 2 0 2 0 0 3 3 2 2 2 3 2 1 1 1\n7 1 0 1 0 0 0 4 4 3 3 1 4 2 3 4 3\n6 1 1 2 1 1 1 1 1 0 0 0 2 4 3 3 3\n5 3 2 2 2 3 2 2 2 1 1 1 2 4 4 4 4\n4 3 3 4 3 3 3 3 3 0 0 0 4 4 3 4 3\n3 0 4 0 4 0 4 0 0 1 1 1 0 0 0 0 0\n2 1 0 1 0 0 0 1 1 2 2 2 1 1 1 1 1\n1 2 1 0 1 1 1 2 2 3 3 3 2 0 0 2 2`,
        seven_big_established: `21 1 2 0 2 2 3 2 2 4 4 4 2 1 1 1 1\n20 0 1 1 0 3 4 0 0 0 1 1 3 0 0 0 0\n19 0 0 1 1 4 4 0 0 1 2 2 0 0 1 0 0\n18 1 2 1 1 0 0 0 0 2 3 3 0 1 2 1 1\n17 1 0 0 0 0 1 1 1 3 4 4 0 2 1 0 0\n16 1 1 1 1 1 1 3 3 0 0 0 3 3 2 3 3\n15 4 2 0 2 2 2 3 3 1 1 1 2 3 3 3 3\n14 4 3 3 3 3 4 4 4 2 0 2 3 4 4 3 3\n13 4 4 4 4 4 0 0 0 1 1 1 0 4 0 4 0\n12 1 0 1 0 0 1 1 1 4 2 4 0 1 1 1 1\n11 2 1 4 1 1 2 1 1 3 3 3 1 0 2 0 2\n10 3 2 1 0 2 3 2 2 4 4 4 1 1 1 1 1\n9 4 1 1 1 3 4 2 2 2 1 1 2 2 2 2 2\n8 0 4 3 2 4 0 3 3 3 2 2 3 2 3 2 2\n7 0 0 0 0 0 0 4 4 4 3 3 4 2 3 2 2\n6 2 4 1 1 2 2 1 1 0 0 0 1 4 3 4 4\n5 2 2 0 2 2 2 2 2 1 1 1 3 4 4 4 4\n4 4 3 1 3 3 4 3 3 2 0 2 3 4 3 4 4\n3 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n2 1 0 3 0 0 1 0 0 4 2 4 0 1 1 1 1\n1 0 1 4 1 1 2 1 1 3 3 3 1 0 0 0 0`,
        reg_bonus_established: `21 1 2 2 2 2 3 2 2 4 4 4 1 1 1 1 1\n20 0 1 0 0 3 4 0 0 1 1 1 0 0 0 2 0\n19 0 0 1 1 4 4 0 0 2 2 2 0 1 1 0 0\n18 1 2 1 1 0 0 0 0 3 3 3 0 2 2 1 1\n17 0 0 0 0 0 1 1 1 4 4 4 1 1 1 0 0\n16 3 1 1 1 1 1 3 3 0 0 0 2 2 2 2 3\n15 3 2 2 2 2 2 3 3 1 1 1 3 3 3 2 3\n14 3 3 3 3 3 4 4 4 0 0 0 4 4 4 3 3\n13 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n12 1 0 0 0 0 1 1 1 2 2 2 1 1 1 1 1\n11 2 1 1 1 1 2 2 2 3 3 3 2 0 2 0 0\n10 3 2 0 0 2 3 3 3 4 4 4 3 1 1 1 1\n9 4 1 1 1 3 4 4 4 4 4 4 4 2 2 1 2\n8 2 4 2 2 4 0 3 3 2 2 2 3 3 3 1 3\n7 2 0 0 0 0 0 4 4 3 3 1 4 3 3 3 4\n6 2 4 1 1 2 2 1 1 0 0 0 3 3 3 3 4\n5 2 2 2 2 2 2 2 2 1 1 1 4 4 4 4 4\n4 4 3 3 3 3 4 3 3 0 0 2 3 3 3 3 4\n3 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n2 1 0 0 0 0 1 0 0 2 2 4 1 1 1 1 1\n1 0 1 1 1 1 2 1 1 3 3 3 0 0 0 0 0`
    },
    middle: {
        bonus_unestablished: `21 4 1 1 1 0 0 2 2 4 4 4 null null null null null\n20 0 2 2 2 1 1 3 3 0 0 0 null null null null null\n19 1 0 0 0 2 2 4 4 1 1 1 null null null null null\n18 2 1 1 1 0 0 2 2 2 2 2 null null null null null\n17 0 2 2 2 1 1 0 0 0 0 0 null null null null null\n16 1 3 3 3 2 2 0 0 1 1 1 null null null null null\n15 0 4 4 4 3 3 0 0 0 0 0 null null null null null\n14 1 0 0 0 4 4 2 2 1 1 1 null null null null null\n13 2 1 1 1 0 0 2 2 2 2 2 null null null null null\n12 3 2 2 2 1 1 4 4 3 3 3 null null null null null\n11 1 3 3 3 2 2 4 4 0 0 0 null null null null null\n10 1 0 0 0 3 3 2 2 1 1 1 null null null null null\n9 3 1 1 1 0 0 3 3 2 2 2 null null null null null\n8 0 2 2 2 1 1 0 0 3 3 3 null null null null null\n7 0 3 3 3 2 2 1 1 4 4 0 null null null null null\n6 1 0 0 0 3 3 2 2 2 2 1 null null null null null\n5 2 1 1 1 0 0 3 3 3 3 2 null null null null null\n4 3 2 2 2 1 1 0 0 0 0 3 null null null null null\n3 1 3 3 3 2 2 1 1 1 1 4 null null null null null\n2 2 4 4 4 3 3 0 0 2 2 2 null null null null null\n1 1 0 0 0 4 4 1 1 3 3 3 null null null null null`,
        x_big_established: `21 2 1 1 1 0 0 2 2 4 4 4 4 2 2 2 4\n20 3 2 2 2 1 1 3 3 0 0 0 4 0 4 0 0\n19 0 0 0 0 2 2 4 4 1 1 1 4 1 4 1 1\n18 1 1 1 1 0 0 1 1 2 2 2 2 2 2 2 2\n17 2 2 2 2 1 1 0 0 0 0 0 3 3 3 3 0\n16 1 3 3 3 2 2 1 1 1 1 1 4 0 0 0 0\n15 1 4 4 4 3 3 1 1 0 0 0 0 0 0 0 0\n14 1 0 0 0 4 4 1 1 1 1 1 1 1 1 1 1\n13 3 1 1 1 0 0 3 3 2 2 2 2 2 2 2 2\n12 3 2 2 2 1 1 3 3 3 3 3 0 3 3 3 2\n11 0 3 3 3 2 2 4 4 0 0 0 0 4 4 4 4\n10 2 0 0 0 3 3 2 2 1 1 1 0 4 4 4 4\n9 2 1 1 1 0 0 2 2 2 2 2 1 0 0 2 1\n8 0 2 2 2 1 1 0 0 0 0 0 0 0 0 0 0\n7 0 3 3 3 2 2 0 0 0 0 0 0 1 1 0 0\n6 1 0 0 0 3 3 1 1 1 1 1 2 0 0 1 2\n5 1 1 1 1 0 0 1 1 3 3 3 3 1 1 2 3\n4 3 2 2 2 1 1 0 0 3 3 3 0 2 2 3 2\n3 3 3 3 3 2 2 1 1 4 4 4 0 3 3 4 4\n2 4 4 4 4 3 3 0 0 4 4 4 1 4 4 4 4\n1 1 0 0 0 4 4 1 1 3 3 3 3 1 1 1 3`,
        seven_big_established: `21 4 1 1 1 0 0 4 4 4 4 4 2 2 2 2 2\n20 0 2 2 2 1 1 4 4 0 0 0 3 0 3 3 3\n19 1 0 0 0 2 2 4 4 1 1 1 4 1 4 0 0\n18 2 1 1 1 0 0 2 2 2 2 2 1 2 1 1 1\n17 3 2 2 2 1 1 0 0 0 0 0 2 3 2 2 0\n16 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n15 0 4 4 4 3 3 0 0 0 0 0 1 0 1 1 1\n14 1 0 0 0 4 4 1 1 1 1 1 2 1 2 2 2\n13 2 1 1 1 0 0 2 2 2 2 2 3 2 3 3 3\n12 2 2 2 2 1 1 4 4 3 3 3 4 3 4 4 4\n11 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4\n10 4 0 0 0 3 3 4 4 4 4 4 4 4 4 4 4\n9 1 1 1 1 0 0 1 1 2 2 2 0 0 0 0 0\n8 3 2 2 2 1 1 3 3 3 3 3 0 0 0 0 0\n7 4 3 3 3 2 2 4 4 4 4 4 1 1 1 1 1\n6 2 0 0 0 3 3 2 2 1 1 1 2 0 2 2 2\n5 3 1 1 1 0 0 3 3 3 3 3 3 1 3 3 3\n4 2 2 2 2 1 1 0 0 3 3 3 0 2 0 0 0\n3 0 3 3 3 2 2 0 0 1 1 1 1 3 1 1 1\n2 1 4 4 4 3 3 1 1 2 2 2 0 4 0 0 0\n1 3 0 0 0 4 4 3 3 3 3 3 1 1 1 1 1`,
        reg_bonus_established: `21 2 1 1 1 0 0 2 2 4 4 4 2 2 2 2 2\n20 0 2 2 2 1 1 4 4 0 0 0 3 3 3 3 3\n19 1 0 0 0 2 2 4 4 1 1 1 4 4 4 4 4\n18 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n17 3 2 2 2 1 1 0 0 0 0 0 3 3 3 3 0\n16 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n15 0 4 4 4 3 3 0 0 0 0 0 0 0 0 0 0\n14 2 0 0 0 4 4 2 2 1 1 1 1 1 1 1 1\n13 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n12 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n11 0 3 3 3 2 2 4 4 0 0 0 4 4 4 4 4\n10 1 0 0 0 3 3 1 1 1 1 1 1 4 4 4 4\n9 2 1 1 1 0 0 2 2 2 2 2 2 0 0 2 2\n8 3 2 2 2 1 1 3 3 3 3 3 3 0 0 3 3\n7 4 3 3 3 2 2 4 4 4 4 4 4 1 1 4 4\n6 2 0 0 0 3 3 2 2 1 1 1 0 0 0 0 0\n5 3 1 1 1 0 0 3 3 3 3 3 1 1 1 1 1\n4 0 2 2 2 1 1 0 0 3 3 3 0 2 2 2 2\n3 3 3 3 3 2 2 1 1 4 4 4 1 3 3 3 3\n2 0 4 4 4 3 3 0 0 2 2 2 0 4 4 0 0\n1 1 0 0 0 4 4 1 1 3 3 3 3 3 3 3 3`
    },
    right: {
        bonus_unestablished: `21 1 0 1 0 3 3 1 1 1 1 3 null null null null null\n20 1 1 2 1 0 0 2 2 2 2 0 null null null null null\n19 3 2 3 2 1 1 1 1 3 3 1 null null null null null\n18 3 3 0 3 2 2 0 0 0 0 2 null null null null null\n17 0 0 1 0 3 3 3 3 1 1 3 null null null null null\n16 1 1 2 1 0 0 2 2 2 2 0 null null null null null\n15 2 2 3 2 1 1 1 1 3 3 1 null null null null null\n14 3 3 0 3 2 2 0 0 0 0 2 null null null null null\n13 1 0 1 0 3 3 3 3 1 1 3 null null null null null\n12 2 1 2 1 4 4 2 2 2 2 4 null null null null null\n11 1 2 3 2 0 0 0 0 3 3 0 null null null null null\n10 4 3 4 3 1 1 4 4 4 4 1 null null null null null\n9 3 4 0 4 2 2 2 2 0 0 2 null null null null null\n8 0 0 1 0 3 3 1 1 1 1 3 null null null null null\n7 2 1 2 1 0 0 0 0 2 2 0 null null null null null\n6 2 2 3 2 1 1 3 3 3 3 1 null null null null null\n5 4 3 0 3 2 2 2 2 0 0 2 null null null null null\n4 0 0 1 0 3 3 1 1 1 1 3 null null null null null\n3 1 1 2 1 0 0 0 0 2 2 0 null null null null null\n2 2 2 3 2 1 1 3 3 3 3 1 null null null null null\n1 0 3 0 3 2 2 2 2 0 0 2 null null null null null`,
        x_big_established: `21 3 0 1 0 3 3 3 3 3 3 3 3 3 3 3 3\n20 4 1 2 1 0 0 4 4 4 4 4 4 4 4 4 4\n19 3 2 3 2 1 1 3 3 1 1 1 1 3 3 1 1\n18 2 3 0 3 2 2 2 2 0 0 0 0 0 0 0 0\n17 1 0 1 0 3 3 1 1 1 1 1 3 1 1 1 1\n16 0 1 2 1 0 0 0 0 2 2 2 2 2 2 0 2\n15 3 2 3 2 1 1 3 3 3 3 3 1 3 3 1 1\n14 2 3 0 3 2 2 2 2 0 0 0 4 2 2 2 4\n13 1 0 1 0 3 3 1 1 3 3 3 0 0 0 3 3\n12 4 1 2 1 4 4 4 4 2 2 2 1 1 1 4 1\n11 3 2 3 2 0 0 3 3 0 0 0 0 0 0 4 0\n10 1 3 4 3 1 1 1 1 4 4 4 3 1 1 4 3\n9 0 4 0 4 2 2 0 0 2 2 2 2 2 2 1 2\n8 3 0 1 0 3 3 3 3 1 1 1 3 3 3 1 3\n7 2 1 2 1 0 0 2 2 0 0 0 4 4 4 0 4\n6 1 2 3 2 1 1 1 1 1 1 1 1 3 3 1 1\n5 0 3 0 3 2 2 0 0 0 0 0 0 0 0 0 0\n4 1 0 1 0 3 3 1 1 1 1 1 1 1 1 1 1\n3 2 1 2 1 0 0 2 2 2 2 2 2 2 2 0 2\n2 1 2 3 2 1 1 1 1 3 3 3 1 3 3 1 1\n1 2 3 0 3 2 2 2 2 2 2 2 2 2 2 2 2`,
        seven_big_established: `21 1 0 1 0 3 3 1 1 1 1 1 3 1 3 3 3\n20 0 1 2 1 0 0 0 0 0 0 0 0 2 0 0 0\n19 1 2 3 2 1 1 1 1 3 3 3 0 3 0 0 0\n18 0 3 0 3 2 2 0 0 0 0 0 2 0 0 0 0\n17 3 0 1 0 3 3 3 3 3 3 3 3 1 1 1 1\n16 2 1 2 1 0 0 2 2 2 2 2 0 2 0 0 0\n15 1 2 3 2 1 1 1 1 1 1 1 1 3 1 1 1\n14 4 3 0 3 2 2 4 4 4 4 4 2 2 2 2 2\n13 0 0 1 0 3 3 3 3 0 0 0 0 0 0 3 0\n12 1 1 2 1 4 4 4 4 1 1 1 0 1 0 4 0\n11 0 2 3 2 0 0 0 0 0 0 0 0 0 0 0 0\n10 3 3 4 3 1 1 1 1 1 1 1 2 1 2 2 2\n9 2 4 0 4 2 2 2 2 2 2 2 2 2 2 2 2\n8 3 0 1 0 3 3 3 3 3 3 3 3 3 3 3 3\n7 4 1 2 1 0 0 4 4 4 4 4 4 4 4 4 4\n6 1 2 3 2 1 1 1 1 3 3 3 1 3 1 1 1\n5 2 3 0 3 2 2 2 2 2 2 2 2 0 2 2 2\n4 3 0 1 0 3 3 3 3 1 1 1 2 1 2 2 2\n3 2 1 2 1 0 0 2 2 2 2 2 0 2 0 0 0\n2 1 2 3 2 1 1 1 1 3 3 3 0 3 0 0 0\n1 2 3 0 3 2 2 2 2 0 0 0 1 0 1 1 1`,
        reg_bonus_established: `21 1 0 0 0 3 3 1 1 1 1 1 1 1 1 1 1\n20 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0\n19 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1\n18 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n17 3 0 0 0 3 3 3 3 1 1 1 1 1 1 1 1\n16 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n15 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n14 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4\n13 1 0 0 0 3 3 1 1 3 3 3 0 3 3 3 3\n12 2 1 1 1 4 4 2 2 2 2 2 0 4 4 4 4\n11 0 2 2 2 0 0 0 0 0 0 0 0 0 0 0 0\n10 4 3 3 3 1 1 4 4 4 4 4 1 1 1 1 1\n9 0 4 4 4 2 2 0 0 2 2 2 2 2 2 0 2\n8 1 0 0 0 3 3 1 1 1 1 1 3 3 3 1 3\n7 0 1 1 1 0 0 0 0 0 0 0 4 4 4 0 4\n6 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1\n5 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n4 3 0 0 0 3 3 3 3 3 3 3 1 1 1 1 1\n3 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n2 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n1 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4`
    }
};
const FLAG_DEFS = [ {k:"hazure",n:"ハズレ",c:"hazure"},{k:"rep_normal",n:"リプレイ",c:"rep"},{k:"rep_jac",n:"JACリプ",c:"rep"},{k:"rep_rt",n:"RTリプ",c:"rep"},{k:"bell_a",n:"ベルＡ",c:"bell"},{k:"bell_b",n:"ベルＢ",c:"bell"},{k:"sui_a",n:"氷Ａ",c:"suika"},{k:"sui_b",n:"氷Ｂ",c:"suika"},{k:"cher_a1",n:"チェＡ1",c:"cher"},{k:"cher_a2",n:"チェＡ2",c:"cher"},{k:"cher_b",n:"チェＢ",c:"cher"},{k:"tok_a",n:"特役Ａ",c:"tok"},{k:"tok_b",n:"特役Ｂ",c:"tok"},{k:"tok_c",n:"特役Ｃ",c:"tok"},{k:"tok_d",n:"特役Ｄ",c:"tok"},{k:"tok_e",n:"特役Ｅ",c:"tok"} ];
const REEL_SYMS = {
    left: ["Sui","Cher","Don","Bell","Rep","Sui","Bell","Rep","Seven","Bell","Rep","Cher","Bar","Bell","Sui","Rep","Don","Don","Don","Rep","Bell"],
    middle: ["Bell","Cher","Rep","Bell","Cher","Sui","Seven","Sui","Bell","Bar","Cher","Rep","Bell","Cher","Don","Rep","Bell","Cher","Sui","Cher","Rep"],
    right: ["Cher","Bell","Sui","Rep","Cher","Seven","Bell","Sui","Rep","Cher","Bell","Rep","Bar","Cher","Bell","Sui","Rep","Don","Bell","Sui","Rep"]
};
let solvedDB = {left:{}, middle:{}, right:{}};
function build() {
    for(const r in solvedDB) {
        for(const s in MASTER_RAW[r]) {
            solvedDB[r][s] = Array.from({length:21}, ()=>({}));
            MASTER_RAW[r][s].trim().split('\n').forEach(line => {
                const cols = line.trim().split(/\s+/);
                const P = parseInt(cols[0], 10);
                FLAG_DEFS.forEach((fd, i) => {
                    const val = cols[i+1]; if(val === "n" || val === "null" || val === undefined) return;
                    const slip = parseInt(val, 10);
                    const stop = ((P + slip - 1) % 21) + 1;
                    if(!solvedDB[r][s][stop-1][fd.k]) solvedDB[r][s][stop-1][fd.k] = [];
                    solvedDB[r][s][stop-1][fd.k].push(slip);
                });
            });
        }
    }
}
const app = {
    // ★指示に基づき初期配置を設定
    state: { reel: 'left', flagMode: 'bonus_unestablished', stopNum: 12, positions: { left: 12, middle: 14, right: 2 } },
    init() { build(); this.render(); this.attach(); this.update(); },
    render() {
        const win = document.getElementById('reel-strip'); win.innerHTML = '';
        const syms = REEL_SYMS[this.state.reel];
        for(let l=0; l<3; l++) {
            syms.forEach((s, i) => {
                const el = document.createElement('div'); el.className = 'symbol';
                el.innerHTML = `<div class="sym-idx">${21-i}</div><div class="sym-bg" style="background-image:url('reel${(this.state.reel==='left'?1:this.state.reel==='middle'?2:3)}.png');background-position:center -${i*60}px;background-size:100% 1260px"></div>`;
                win.appendChild(el);
            });
        }
    },
    update() {
        const list = document.getElementById('result-list'); list.innerHTML = '';
        const data = solvedDB[this.state.reel][this.state.flagMode][this.state.stopNum-1];
        if(data) {
            FLAG_DEFS.forEach(fd => {
                if(data[fd.k]) {
                    const slips = [...new Set(data[fd.k])].sort((a,b)=>b-a);
                    const row = document.createElement('div'); row.className = `res-row f-${fd.c}`;
                    row.innerHTML = `<div class="res-name">${fd.n}</div><div class="res-data">${slips.map(s=>`<span class="res-slip">${s}</span>`).join('')}</div>`;
                    list.appendChild(row);
                }
            });
        }
        const y = -(21*60) - ((21-this.state.stopNum)*60) + 240; // index.html座標
        document.getElementById('reel-strip').style.transform = `translate3d(0, ${y}px, 0)`;
    },
    setStop(r) { this.state.reel = r; this.state.stopNum = this.state.positions[r]; document.querySelectorAll('.stop-tab').forEach(el => el.classList.toggle('active', el.id === `t-${r}`)); this.render(); this.update(); },
    setState(s) { this.state.flagMode = s; document.querySelectorAll('.state-tab').forEach(el => el.classList.toggle('active', el.id === `s-${s}`)); this.update(); },
    attach() {
        let isD = false, sy = 0, sn = 0;
        const area = document.getElementById('touch-area');
        const st = (y) => { isD = true; sy = y; sn = this.state.stopNum; };
        const mv = (y) => { if(!isD) return; let n = sn - Math.round((sy - y)/60); while(n>21)n-=21; while(n<1)n+=21; if(this.state.stopNum!==n){this.state.stopNum=n; this.state.positions[this.state.reel]=n; this.update();} };
        area.addEventListener('touchstart', e => { st(e.touches[0].pageY); e.preventDefault(); }, {passive:false});
        window.addEventListener('touchmove', e => { mv(e.touches[0].pageY); e.preventDefault(); }, {passive:false});
        window.addEventListener('touchend', () => isD = false);
    }
};
window.onload = () => app.init();
</script>
</body>
</html>