<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>生物学的適応シミュレーター：新種（新ハナビ）</title>
    <style>
        :root { --cell-size: 60px; }
        body { font-family: sans-serif; background: #222; color: #ddd; display: flex; flex-direction: column; align-items: center; }
        .control-panel { background: #333; padding: 20px; border-radius: 8px; margin: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .reel-container { display: flex; gap: 10px; background: #000; padding: 20px; border: 4px solid #444; border-radius: 10px; }
        .reel-window { width: calc(var(--cell-size) * 1.5); height: calc(var(--cell-size) * 3); overflow: hidden; position: relative; border: 2px solid #666; background: #fff; }
        .reel { position: absolute; width: 100%; transition: transform 0.1s ease-out; display: flex; flex-direction: column-reverse; }
        .symbol { height: var(--cell-size); width: 100%; background-repeat: no-repeat; background-position: center; background-size: contain; }
        .result-panel { margin-top: 20px; padding: 15px; background: #333; border-radius: 5px; min-width: 300px; text-align: center; }
        select, button { padding: 8px; background: #444; color: #fff; border: 1px solid #666; cursor: pointer; }
        .tab-group { display: flex; gap: 5px; margin-bottom: 10px; grid-column: span 3; }
        .tab { padding: 10px 20px; background: #444; border: none; color: #aaa; cursor: pointer; }
        .tab.active { background: #666; color: #fff; font-weight: bold; }
    </style>
</head>
<body>

<div class="control-panel">
    <div class="tab-group" id="state-tabs">
        <button class="tab active" data-state="ボーナス未成立">ボーナス未成立</button>
        <button class="tab" data-state="ドンビッグ成立">ドンビッグ成立</button>
        <button class="tab" data-state="七ビッグ成立">七ビッグ成立</button>
        <button class="tab" data-state="Regボーナス成立">Regボーナス成立</button>
    </div>

    <div>
        <label>リール選択:</label><br>
        <select id="reel-select">
            <option value="0">左リール</option>
            <option value="1">中リール</option>
            <option value="2">右リール</option>
        </select>
    </div>
    <div>
        <label>停止位置 (1-21):</label><br>
        <input type="number" id="pos-input" min="1" max="21" value="1" style="width: 60px; padding: 7px; background: #444; color: #fff; border: 1px solid #666;">
    </div>
    <div>
        <label>成立役 (環境因子):</label><br>
        <select id="flag-select"></select>
    </div>
</div>

<div class="reel-container">
    <div class="reel-window"><div class="reel" id="reel-0"></div></div>
    <div class="reel-window"><div class="reel" id="reel-1"></div></div>
    <div class="reel-window"><div class="reel" id="reel-2"></div></div>
</div>

<div class="result-panel">
    <div id="slide-result" style="font-size: 24px; color: #ffeb3b;">滑りコマ数: -</div>
    <div id="debug-info" style="font-size: 12px; color: #888; margin-top: 10px;"></div>
</div>

<script>
// --- システム定数定義 ---
const REEL_NAMES = ["左リール", "中リール", "右リール"];
const FLAG_ORDER = ["ハズレ", "通リプ", "JACリプ", "RTリプ", "ベルA", "ベルB", "氷A", "氷B", "チェA1", "チェA2", "チェB", "特A", "特B", "特C", "特D", "特E"];

// 生物データベース (DNA)
const biologicalDatabase = {
    "左リール": {}, "中リール": {}, "右リール": {}
};

// --- データ注入関数 ---
function parseAndRegister(reelName, stateName, rawData) {
    const lines = rawData.trim().split('\n');
    biologicalDatabase[reelName][stateName] = {};
    
    lines.forEach(line => {
        const parts = line.trim().split(/\s+/);
        const pos = parseInt(parts[0]);
        const behaviors = parts.slice(1).map(v => v === "null" ? null : parseInt(v));
        biologicalDatabase[reelName][stateName][pos] = behaviors;
    });
}

// --- データの登録 (ご提示いただいた全DNA) ---
// 左リール
parseAndRegister("左リール", "ボーナス未成立", `21 1 2 1 1 2 3 2 2 4 4 4 null null null null null\n20 0 0 2 0 3 4 0 0 1 1 1 null null null null null\n19 0 1 3 1 4 4 0 0 2 2 2 null null null null null\n18 1 1 0 1 0 0 2 2 3 3 3 null null null null null\n17 0 0 1 0 0 1 1 1 4 4 4 null null null null null\n16 2 1 2 1 1 2 3 3 0 0 0 null null null null null\n15 3 2 3 2 2 3 3 3 1 1 1 null null null null null\n14 3 3 1 3 3 4 4 4 0 0 2 null null null null null\n13 0 4 2 4 4 4 0 0 1 1 1 null null null null null\n12 1 0 3 0 0 1 1 1 2 2 4 null null null null null\n11 0 1 0 0 1 2 1 1 3 3 3 null null null null null\n10 1 0 1 1 2 3 2 2 4 4 4 null null null null null\n9 2 1 2 1 3 4 2 2 1 1 1 null null null null null\n8 0 2 0 2 4 0 3 3 2 2 2 null null null null null\n7 1 0 1 0 0 0 4 4 3 3 3 null null null null null\n6 2 1 2 1 2 1 1 1 0 0 0 null null null null null\n5 3 2 3 2 2 3 3 3 1 1 1 null null null null null\n4 4 3 1 3 3 4 3 3 0 0 2 null null null null null\n3 0 4 2 4 4 4 0 0 1 1 1 null null null null null\n2 1 0 3 0 0 0 0 0 2 2 4 null null null null null\n1 1 1 0 0 1 2 1 1 3 3 3 null null null null null`);
parseAndRegister("左リール", "ドンビッグ成立", `21 3 2 1 2 2 2 3 3 4 4 4 3 1 1 3 3\n20 4 0 2 0 3 4 4 4 1 1 1 4 0 2 4 4\n19 0 1 0 1 4 4 0 0 2 2 2 4 0 0 2 0\n18 1 1 1 1 0 0 2 2 3 3 3 1 1 1 2 1\n17 0 0 1 0 0 1 1 1 4 4 4 1 2 2 4 0\n16 2 1 3 1 1 1 3 3 0 0 0 1 3 2 3 2\n15 2 2 3 2 2 3 3 3 1 1 1 4 3 4 3 2\n14 3 3 4 3 3 4 4 4 0 0 2 4 4 4 3 3\n13 0 4 0 4 0 4 0 0 1 1 1 0 0 0 0 0\n12 1 0 0 0 0 1 1 1 2 2 4 1 1 1 1 1\n11 0 1 1 1 1 1 0 0 3 3 3 0 0 0 0 0\n10 1 0 2 0 3 2 1 1 4 4 4 1 1 1 0 1\n9 1 1 4 1 4 4 2 2 1 1 1 2 2 1 2 1\n8 1 2 0 2 0 0 3 3 2 2 2 3 2 1 1 1\n7 1 0 1 0 0 0 4 4 3 3 1 4 2 3 4 3\n6 1 1 2 1 1 1 1 1 0 0 0 2 4 3 3 3\n5 3 2 2 2 3 2 2 2 1 1 1 2 4 4 4 4\n4 3 3 4 3 3 3 3 3 0 0 0 4 4 3 4 3\n3 0 4 0 4 0 4 0 0 1 1 1 0 0 0 0 0\n2 1 0 1 0 0 0 1 1 2 2 2 1 1 1 1 1\n1 2 1 0 1 1 1 2 2 3 3 3 2 0 0 2 2`);
parseAndRegister("左リール", "七ビッグ成立", `21 1 2 0 2 2 3 2 2 4 4 4 2 1 1 1 1\n20 0 1 1 0 3 4 0 0 0 1 1 3 0 0 0 0\n19 0 0 1 1 4 4 0 0 1 2 2 0 0 1 0 0\n18 1 2 1 1 0 0 0 0 2 3 3 0 1 2 1 1\n17 1 0 0 0 0 1 1 1 3 4 4 0 2 1 0 0\n16 1 1 1 1 1 1 3 3 0 0 0 3 3 2 3 3\n15 4 2 0 2 2 2 3 3 1 1 1 2 3 3 3 3\n14 4 3 3 3 3 4 4 4 2 0 2 3 4 4 3 3\n13 4 4 4 4 4 0 0 0 1 1 1 0 4 0 4 0\n12 1 0 1 0 0 1 1 1 4 2 4 0 1 1 1 1\n11 2 1 4 1 1 2 1 1 3 3 3 1 0 2 0 2\n10 3 2 1 0 2 3 2 2 4 4 4 1 1 1 1 1\n9 4 1 1 1 3 4 2 2 2 1 1 2 2 2 2 2\n8 0 4 3 2 4 0 3 3 3 2 2 3 2 3 2 2\n7 0 0 0 0 0 0 4 4 4 3 3 4 2 3 2 2\n6 2 4 1 1 2 2 1 1 0 0 0 1 4 3 4 4\n5 2 2 0 2 2 2 2 2 1 1 1 3 4 4 4 4\n4 4 3 1 3 3 4 3 3 2 0 2 3 4 3 4 4\n3 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n2 1 0 3 0 0 1 0 0 4 2 4 0 1 1 1 1\n1 0 1 4 1 1 2 1 1 3 3 3 1 0 0 0 0`);
parseAndRegister("左リール", "Regボーナス成立", `21 1 2 2 2 2 3 2 2 4 4 4 1 1 1 1 1\n20 0 1 0 0 3 4 0 0 1 1 1 0 0 0 2 0\n19 0 0 1 1 4 4 0 0 2 2 2 0 1 1 0 0\n18 1 2 1 1 0 0 0 0 3 3 3 0 2 2 1 1\n17 0 0 0 0 0 1 1 1 4 4 4 1 1 1 0 0\n16 3 1 1 1 1 1 3 3 0 0 0 2 2 2 2 3\n15 3 2 2 2 2 2 3 3 1 1 1 3 3 3 2 3\n14 3 3 3 3 3 4 4 4 0 0 0 4 4 4 3 3\n13 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n12 1 0 0 0 0 1 1 1 2 2 2 1 1 1 1 1\n11 2 1 1 1 1 2 2 2 3 3 3 2 0 2 0 0\n10 3 2 0 0 2 3 3 3 4 4 4 3 1 1 1 1\n9 4 1 1 1 3 4 4 4 4 4 4 4 2 2 1 2\n8 2 4 2 2 4 0 3 3 2 2 2 3 3 3 1 3\n7 2 0 0 0 0 0 4 4 3 3 1 4 3 3 3 4\n6 2 4 1 1 2 2 1 1 0 0 0 3 3 3 3 4\n5 2 2 2 2 2 2 2 2 1 1 1 4 4 4 4 4\n4 4 3 3 3 3 4 3 3 0 0 2 3 3 3 3 4\n3 0 4 4 4 4 0 0 0 1 1 1 0 0 0 0 0\n2 1 0 0 0 0 1 0 0 2 2 4 1 1 1 1 1\n1 0 1 1 1 1 2 1 1 3 3 3 0 0 0 0 0`);

// 中リール
parseAndRegister("中リール", "ボーナス未成立", `21 4 1 1 1 0 0 2 2 4 4 4 null null null null null\n20 0 2 2 2 1 1 3 3 0 0 0 null null null null null\n19 1 0 0 0 2 2 4 4 1 1 1 null null null null null\n18 2 1 1 1 0 0 2 2 2 2 2 null null null null null\n17 0 2 2 2 1 1 0 0 0 0 0 null null null null null\n16 1 3 3 3 2 2 0 0 1 1 1 null null null null null\n15 0 4 4 4 3 3 0 0 0 0 0 null null null null null\n14 1 0 0 0 4 4 2 2 1 1 1 null null null null null\n13 2 1 1 1 0 0 2 2 2 2 2 null null null null null\n12 3 2 2 2 1 1 4 4 3 3 3 null null null null null\n11 1 3 3 3 2 2 4 4 0 0 0 null null null null null\n10 1 0 0 0 3 3 2 2 1 1 1 null null null null null\n9 3 1 1 1 0 0 3 3 2 2 2 null null null null null\n8 0 2 2 2 1 1 0 0 3 3 3 null null null null null\n7 0 3 3 3 2 2 1 1 4 4 0 null null null null null\n6 1 0 0 0 3 3 2 2 2 2 1 null null null null null\n5 2 1 1 1 0 0 3 3 3 3 2 null null null null null\n4 3 2 2 2 1 1 0 0 0 0 3 null null null null null\n3 1 3 3 3 2 2 1 1 1 1 4 null null null null null\n2 2 4 4 4 3 3 0 0 2 2 2 null null null null null\n1 1 0 0 0 4 4 1 1 3 3 3 null null null null null`);
parseAndRegister("中リール", "ドンビッグ成立", `21 2 1 1 1 0 0 2 2 4 4 4 4 2 2 2 4\n20 3 2 2 2 1 1 3 3 0 0 0 4 0 4 0 0\n19 0 0 0 0 2 2 4 4 1 1 1 4 1 4 1 1\n18 1 1 1 1 0 0 1 1 2 2 2 2 2 2 2 2\n17 2 2 2 2 1 1 0 0 0 0 0 3 3 3 3 0\n16 1 3 3 3 2 2 1 1 1 1 1 4 0 0 0 0\n15 1 4 4 4 3 3 1 1 0 0 0 0 0 0 0 0\n14 1 0 0 0 4 4 1 1 1 1 1 1 1 1 1 1\n13 3 1 1 1 0 0 3 3 2 2 2 2 2 2 2 2\n12 3 2 2 2 1 1 3 3 3 3 3 0 3 3 3 2\n11 0 3 3 3 2 2 4 4 0 0 0 0 4 4 4 4\n10 2 0 0 0 3 3 2 2 1 1 1 0 4 4 4 4\n9 2 1 1 1 0 0 2 2 2 2 2 1 0 0 2 1\n8 0 2 2 2 1 1 0 0 0 0 0 0 0 0 0 0\n7 0 3 3 3 2 2 0 0 0 0 0 0 1 1 0 0\n6 1 0 0 0 3 3 1 1 1 1 1 2 0 0 1 2\n5 1 1 1 1 0 0 1 1 3 3 3 3 1 1 2 3\n4 3 2 2 2 1 1 0 0 3 3 3 0 2 2 3 2\n3 3 3 3 3 2 2 1 1 4 4 4 0 3 3 4 4\n2 4 4 4 4 3 3 0 0 4 4 4 1 4 4 4 4\n1 1 0 0 0 4 4 1 1 3 3 3 3 1 1 1 3`);
parseAndRegister("中リール", "七ビッグ成立", `21 4 1 1 1 0 0 4 4 4 4 4 2 2 2 2 2\n20 0 2 2 2 1 1 4 4 0 0 0 3 0 3 3 3\n19 1 0 0 0 2 2 4 4 1 1 1 4 1 4 0 0\n18 2 1 1 1 0 0 2 2 2 2 2 1 2 1 1 1\n17 3 2 2 2 1 1 0 0 0 0 0 2 3 2 2 0\n16 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n15 0 4 4 4 3 3 0 0 0 0 0 1 0 1 1 1\n14 1 0 0 0 4 4 1 1 1 1 1 2 1 2 2 2\n13 2 1 1 1 0 0 2 2 2 2 2 3 2 3 3 3\n12 2 2 2 2 1 1 4 4 3 3 3 4 3 4 4 4\n11 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4\n10 4 0 0 0 3 3 4 4 4 4 4 4 4 4 4 4\n9 1 1 1 1 0 0 1 1 2 2 2 0 0 0 0 0\n8 3 2 2 2 1 1 3 3 3 3 3 0 0 0 0 0\n7 4 3 3 3 2 2 4 4 4 4 4 1 1 1 1 1\n6 2 0 0 0 3 3 2 2 1 1 1 2 0 2 2 2\n5 3 1 1 1 0 0 3 3 3 3 3 3 1 3 3 3\n4 2 2 2 2 1 1 0 0 3 3 3 0 2 0 0 0\n3 0 3 3 3 2 2 0 0 1 1 1 1 3 1 1 1\n2 1 4 4 4 3 3 1 1 2 2 2 0 4 0 0 0\n1 3 0 0 0 4 4 3 3 3 3 3 1 1 1 1 1`);
parseAndRegister("中リール", "Regボーナス成立", `21 2 1 1 1 0 0 2 2 4 4 4 2 2 2 2 2\n20 0 2 2 2 1 1 4 4 0 0 0 3 3 3 3 3\n19 1 0 0 0 2 2 4 4 1 1 1 4 4 4 4 4\n18 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n17 3 2 2 2 1 1 0 0 0 0 0 3 3 3 3 0\n16 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n15 0 4 4 4 3 3 0 0 0 0 0 0 0 0 0 0\n14 2 0 0 0 4 4 2 2 1 1 1 1 1 1 1 1\n13 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n12 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n11 0 3 3 3 2 2 4 4 0 0 0 4 4 4 4 4\n10 1 0 0 0 3 3 1 1 1 1 1 1 4 4 4 4\n9 2 1 1 1 0 0 2 2 2 2 2 2 0 0 2 2\n8 3 2 2 2 1 1 3 3 3 3 3 3 0 0 3 3\n7 4 3 3 3 2 2 4 4 4 4 4 4 1 1 4 4\n6 2 0 0 0 3 3 2 2 1 1 1 0 0 0 0 0\n5 3 1 1 1 0 0 3 3 3 3 3 1 1 1 1 1\n4 0 2 2 2 1 1 0 0 3 3 3 0 2 2 2 2\n3 3 3 3 3 2 2 1 1 4 4 4 1 3 3 3 3\n2 0 4 4 4 3 3 0 0 2 2 2 0 4 4 0 0\n1 1 0 0 0 4 4 1 1 3 3 3 3 3 3 3 3`);

// 右リール
parseAndRegister("右リール", "ボーナス未成立", `21 1 0 1 0 3 3 1 1 1 1 3 null null null null null\n20 1 1 2 1 0 0 2 2 2 2 0 null null null null null\n19 3 2 3 2 1 1 1 1 3 3 1 null null null null null\n18 3 3 0 3 2 2 0 0 0 0 2 null null null null null\n17 0 0 1 0 3 3 3 3 1 1 3 null null null null null\n16 1 1 2 1 0 0 2 2 2 2 0 null null null null null\n15 2 2 3 2 1 1 1 1 3 3 1 null null null null null\n14 3 3 0 3 2 2 0 0 0 0 2 null null null null null\n13 1 0 1 0 3 3 3 3 1 1 3 null null null null null\n12 2 1 2 1 4 4 2 2 2 2 4 null null null null null\n11 1 2 3 2 0 0 0 0 3 3 0 null null null null null\n10 4 3 4 3 1 1 4 4 4 4 1 null null null null null\n9 3 4 0 4 2 2 2 2 0 0 2 null null null null null\n8 0 0 1 0 3 3 1 1 1 1 3 null null null null null\n7 2 1 2 1 0 0 0 0 2 2 0 null null null null null\n6 2 2 3 2 1 1 3 3 3 3 1 null null null null null\n5 4 3 0 3 2 2 2 2 0 0 2 null null null null null\n4 0 0 1 0 3 3 1 1 1 1 3 null null null null null\n3 1 1 2 1 0 0 0 0 2 2 0 null null null null null\n2 2 2 3 2 1 1 3 3 3 3 1 null null null null null\n1 0 3 0 3 2 2 2 2 0 0 2 null null null null null`);
parseAndRegister("右リール", "ドンビッグ成立", `21 3 0 1 0 3 3 3 3 3 3 3 3 3 3 3 3\n20 4 1 2 1 0 0 4 4 4 4 4 4 4 4 4 4\n19 3 2 3 2 1 1 3 3 1 1 1 1 3 3 1 1\n18 2 3 0 3 2 2 2 2 0 0 0 0 0 0 0 0\n17 1 0 1 0 3 3 1 1 1 1 1 3 1 1 1 1\n16 0 1 2 1 0 0 0 0 2 2 2 2 2 2 0 2\n15 3 2 3 2 1 1 3 3 3 3 3 1 3 3 1 1\n14 2 3 0 3 2 2 2 2 0 0 0 4 2 2 2 4\n13 1 0 1 0 3 3 1 1 3 3 3 0 0 0 3 3\n12 4 1 2 1 4 4 4 4 2 2 2 1 1 1 4 1\n11 3 2 3 2 0 0 3 3 0 0 0 0 0 0 4 0\n10 1 3 4 3 1 1 1 1 4 4 4 3 1 1 4 3\n9 0 4 0 4 2 2 0 0 2 2 2 2 2 2 1 2\n8 3 0 1 0 3 3 3 3 1 1 1 3 3 3 1 3\n7 2 1 2 1 0 0 2 2 0 0 0 4 4 4 0 4\n6 1 2 3 2 1 1 1 1 1 1 1 1 3 3 1 1\n5 0 3 0 3 2 2 0 0 0 0 0 0 0 0 0 0\n4 1 0 1 0 3 3 1 1 1 1 1 1 1 1 1 1\n3 2 1 2 1 0 0 2 2 2 2 2 2 2 2 0 2\n2 1 2 3 2 1 1 1 1 3 3 3 1 3 3 1 1\n1 2 3 0 3 2 2 2 2 2 2 2 2 2 2 2 2`);
parseAndRegister("右リール", "七ビッグ成立", `21 1 0 1 0 3 3 1 1 1 1 1 3 1 3 3 3\n20 0 1 2 1 0 0 0 0 0 0 0 0 2 0 0 0\n19 1 2 3 2 1 1 1 1 3 3 3 0 3 0 0 0\n18 0 3 0 3 2 2 0 0 0 0 0 2 0 0 0 0\n17 3 0 1 0 3 3 3 3 3 3 3 3 1 1 1 1\n16 2 1 2 1 0 0 2 2 2 2 2 0 2 0 0 0\n15 1 2 3 2 1 1 1 1 1 1 1 1 3 1 1 1\n14 4 3 0 3 2 2 4 4 4 4 4 2 2 2 2 2\n13 0 0 1 0 3 3 3 3 0 0 0 0 0 0 3 0\n12 1 1 2 1 4 4 4 4 1 1 1 0 1 0 4 0\n11 0 2 3 2 0 0 0 0 0 0 0 0 0 0 0 0\n10 3 3 4 3 1 1 1 1 1 1 1 2 1 2 2 2\n9 2 4 0 4 2 2 2 2 2 2 2 2 2 2 2 2\n8 3 0 1 0 3 3 3 3 3 3 3 3 3 3 3 3\n7 4 1 2 1 0 0 4 4 4 4 4 4 4 4 4 4\n6 1 2 3 2 1 1 1 1 3 3 3 1 3 1 1 1\n5 2 3 0 3 2 2 2 2 2 2 2 2 0 2 2 2\n4 3 0 1 0 3 3 3 3 1 1 1 2 1 2 2 2\n3 2 1 2 1 0 0 2 2 2 2 2 0 2 0 0 0\n2 1 2 3 2 1 1 1 1 3 3 3 0 3 0 0 0\n1 2 3 0 3 2 2 2 2 0 0 0 1 0 1 1 1`);
parseAndRegister("右リール", "Regボーナス成立", `21 1 0 0 0 3 3 1 1 1 1 1 1 1 1 1 1\n20 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0\n19 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1\n18 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n17 3 0 0 0 3 3 3 3 1 1 1 1 1 1 1 1\n16 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n15 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n14 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4\n13 1 0 0 0 3 3 1 1 3 3 3 0 3 3 3 3\n12 2 1 1 1 4 4 2 2 2 2 2 0 4 4 4 4\n11 0 2 2 2 0 0 0 0 0 0 0 0 0 0 0 0\n10 4 3 3 3 1 1 4 4 4 4 4 1 1 1 1 1\n9 0 4 4 4 2 2 0 0 2 2 2 2 2 2 0 2\n8 1 0 0 0 3 3 1 1 1 1 1 3 3 3 1 3\n7 0 1 1 1 0 0 0 0 0 0 0 4 4 4 0 4\n6 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1\n5 0 3 3 3 2 2 0 0 0 0 0 0 0 0 0 0\n4 3 0 0 0 3 3 3 3 3 3 3 1 1 1 1 1\n3 2 1 1 1 0 0 2 2 2 2 2 2 2 2 2 2\n2 3 2 2 2 1 1 3 3 3 3 3 3 3 3 3 3\n1 4 3 3 3 2 2 4 4 4 4 4 4 4 4 4 4`);


// --- UI制御ロジック ---
let currentState = "ボーナス未成立";

function initApp() {
    // 成立役プルダウン生成
    const flagSelect = document.getElementById('flag-select');
    FLAG_ORDER.forEach((flag, idx) => {
        const opt = document.createElement('option');
        opt.value = idx;
        opt.textContent = flag;
        flagSelect.appendChild(opt);
    });

    // タブ切り替えイベント
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            e.target.classList.add('active');
            currentState = e.target.getAttribute('data-state');
            updateSimulation();
        });
    });

    // 入力変更イベント
    document.getElementById('reel-select').addEventListener('change', updateSimulation);
    document.getElementById('pos-input').addEventListener('input', updateSimulation);
    document.getElementById('flag-select').addEventListener('change', updateSimulation);

    // リール初期化
    REEL_NAMES.forEach((name, idx) => {
        const reelEl = document.getElementById(`reel-${idx}`);
        for (let i = 1; i <= 21; i++) {
            const sym = document.createElement('div');
            sym.className = 'symbol';
            sym.style.backgroundImage = `url('reel${idx + 1}.png')`;
            // 背景位置の計算は画像に合わせて調整が必要 (例: 1コマ60px)
            sym.style.backgroundPositionY = `-${(i-1) * 60}px`; 
            reelEl.appendChild(sym);
        }
    });

    updateSimulation();
}

function updateSimulation() {
    const reelIdx = parseInt(document.getElementById('reel-select').value);
    const reelName = REEL_NAMES[reelIdx];
    const pos = parseInt(document.getElementById('pos-input').value);
    const flagIdx = parseInt(document.getElementById('flag-select').value);

    const dataSet = biologicalDatabase[reelName][currentState];
    const debugEl = document.getElementById('debug-info');

    if (dataSet && dataSet[pos]) {
        const slide = dataSet[pos][flagIdx];
        const resultEl = document.getElementById('slide-result');
        
        if (slide === null) {
            resultEl.textContent = "滑りコマ数: 未定義";
            resultEl.style.color = "#ff5252";
        } else {
            resultEl.textContent = `滑りコマ数: ${slide}`;
            resultEl.style.color = "#ffeb3b";
        }
        
        debugEl.textContent = `[DEBUG] Reel: ${reelName} | State: ${currentState} | Pos: ${pos} | Flag: ${FLAG_ORDER[flagIdx]}`;
        
        // 視覚的反映
        const reelEl = document.getElementById(`reel-${reelIdx}`);
        const offset = (pos - 1 + (slide || 0)) % 21;
        reelEl.style.transform = `translateY(${offset * 60}px)`;
    }
}

window.onload = initApp;
</script>

</body>
</html>